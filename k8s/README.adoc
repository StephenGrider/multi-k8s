# Kubernetes Setup

## Linking kubectl to GCloud
....
gcloud config set project [PROJECT_ID]
gcloud config set compute/zone europe-west1-b
gcloud auth application-default login
gcloud container clusters get-credentials [CLUSTER_NAME]
....

Check configuration
....
kubectl config current-context
kubectl cluster-info
....

## Installation of Helm
....
curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get > get_helm.sh
chmod 700 get_helm.sh
./get_helm.sh

kubectl create serviceaccount --namespace kube-system tiller
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller
....

## Installation of NGINX with Helm
....
helm init --service-account tiller --upgrade
helm install stable/nginx-ingress --name my-nginx --set rbac.create=true
....

## Creating PGSQL Password
....
kubectl create secret generic pgpassword --from-literal PGPASSWORD=mypgpassword123
....


## Installation of the Certificate Manager
....
kubectl apply -f https://raw.githubusercontent.com/jetstack/cert-manager/release-0.10/deploy/manifests/00-crds.yaml
kubectl create namespace cert-manager

kubectl label namespace cert-manager certmanager.k8s.io/disable-validation=true

helm repo add jetstack https://charts.jetstack.io
helm repo update

helm install \
  --name cert-manager \
  --namespace cert-manager \
  --version v0.10.0 \
  jetstack/cert-manager
....

## Some Useful Commands for Certificates
....
kubectl describe certificates
kubectl describe order [ORDER_ID]
kubectl describe challenge [CHALLENGE_ID]

# For re-creation
kubectl delete secret [SECRET_ID]
....

